#!/bin/sh

set -euo pipefail
export BCG_E=`basename ${0}`


#======================================================================================================================
# Check arguments.
#======================================================================================================================

[[ -n "${1-}" ]] && VERSION="wordpress-${1}" \
    || VERSION="latest"

[[ -n "${2-}" ]] && LOCALE="${2}" \
    || bcg-error "You must set the WordPress locale before downloading the source."


#======================================================================================================================
# Download WordPress.
#======================================================================================================================

BCG_SRC=/etc/bcg/src
cd ${BCG_SRC}

URL="https://${LOCALE}.wordpress.org/${VERSION}-${LOCALE}.zip"

bcg-echo "Downloading ${URL}..."
wget -O wp.zip ${URL} \
    && unzip -oq wp.zip \
    && rm wp.zip

WP_SRC=${BCG_SRC}/wordpress
[[ -d ${WP_SRC} ]] && bcg-done \
    || bcg-error "WordPress not downloaded."


#======================================================================================================================
# Set permissions on source files.
#======================================================================================================================

bcg-echo "Setting permissions on ${WP_SRC}..." # see /wp entry in fix-attrs.d/30-wp for correct permissions
chown -R www:www ${WP_SRC}
find ${WP_SRC} -type f -exec chmod 0444 {} +
find ${WP_SRC} -type d -exec chmod 0755 {} +
bcg-done
