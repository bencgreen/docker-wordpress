#!/bin/sh

set -euo pipefail
export BCG_E=`basename ${0}`


#======================================================================================================================
# Download WordPress.
#======================================================================================================================

cd /src

[[ -n "${1-}" ]] && VERSION="${1}-"
[[ -n "${2-}" ]] && LOCALE="${2}" \
    || bcg-error "You must set the WordPress locale before downloading the source."

URL="https://${LOCALE}.wordpress.org/latest-${VERSION-}${LOCALE}.zip"

bcg-echo "Downloading ${URL}..."
wget -O wp.zip ${URL} \
    && unzip -oq wp.zip \
    && rm wp.zip

[[ -d ./wordpress ]] && bcg-done \
    || bcg-error "WordPress not downloaded."


#======================================================================================================================
# Set www permissions on source files.
#======================================================================================================================

bcg-echo "Setting permissions on /src..."
chown -R www:www /src
find /src -type f -exec chmod 0644 {} +
find /src -type d -exec chmod 0755 {} +
bcg-done
