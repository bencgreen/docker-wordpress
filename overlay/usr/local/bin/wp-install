#!/usr/bin/with-contenv bash

#======================================================================================================================
# Download WordPress
#======================================================================================================================

cd /tmp

URL="https://${WORDPRESS_LOCALE}.wordpress.org/latest-${WORDPRESS_LOCALE}.zip"
echo " - downloading ${URL}..."
wget -O wp.zip ${URL}
unzip -q wp.zip && rm wp.zip

if [ -d ./wordpress ] ; then
    echo " - done."
else
    echo " - error."
    exit 1
fi


#======================================================================================================================
# Move WordPress files to /var/www/localhost
#======================================================================================================================

echo " - moving WordPress files to /var/www/localhost..."
mv wordpress/* /var/www/localhost/ && rm -rf wordpress
echo " - done."


#======================================================================================================================
# Move wp-content directories to /etc/wp
#======================================================================================================================

DIR_WP=/etc/wp
DIR_WWW=/var/www/localhost
DIR_CONTENT=${DIR_WWW}/wp-content

cd ${DIR_CONTENT}
mv plugins/* ${DIR_WP}/plugins/ && rm -rf plugins
mv themes/* ${DIR_WP}/themes/ && rm -rf themes


#======================================================================================================================
# Create symlinks
#======================================================================================================================

touch ${DIR_WP}/wp-config.php \
    && ln -s ${DIR_WP}/wp-config.php ${DIR_WWW}/wp-config.php

create_link "plugins"
create_link "themes"
create_link "uploads"

function create_link () {
    if [ ! -d ${DIR_WP}/$1 ] ; then
        mkdir ${DIR_WP}/$1
    fi

    ln -s ${DIR_WP}/$1 ${DIR_CONTENT}/$1
}
