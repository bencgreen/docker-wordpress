#!/usr/bin/with-contenv bash

source /etc/wp/directories.sh


#======================================================================================================================
# Clean directories
#======================================================================================================================

_echo "Deleting contents of ${WWW} and ${WP}..."
rm -rf ${WWW}/* ${WP}/*
_done


#======================================================================================================================
# Download WordPress
#======================================================================================================================

cd /tmp

URL="https://${WORDPRESS_LOCALE}.wordpress.org/latest-${WORDPRESS_LOCALE}.zip"
_echo "Downloading ${URL}..."
wget -O wp.zip ${URL}
unzip -q wp.zip
rm wp.zip

if [ -d ./wordpress ] ; then
    _done
else
    _error "WordPress not downloaded."
    exit 1
fi


#======================================================================================================================
# Move WordPress files to /www
#======================================================================================================================

_echo "Moving WordPress files to ${WWW}..."
mv wordpress/* ${WWW} && rm -rf wordpress

if [ -f ${WWW}/wp-load.php ] ; then
    _done
else
    _error "WordPress not installed."
    exit 1
fi
